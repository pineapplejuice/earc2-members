{% extends "base.html" %}
{% load static %}

{% block browsertitle %}EARC - Pay Your EARC Dues{% endblock %}


{% block content %}

	<h2>Pay Your EARC Dues</h2>
	<p>You can pay your EARC dues via PayPal by clicking the button below and following the instructions. If you do not have a PayPal account, you can click the "Pay by debit or credit card" button.</p>
	<p>Alternatively, you can send a check or money order for your dues (payable to EARC) to the following address:</p>
	<address>
		Emergency Amateur Radio Club<br />
		PO Box 30315<br />
		Honolulu, HI  96820-0315		
	</address>
	
	{% if member.membership_status == 'P' %}
	<p>You have not yet paid dues. You can join the EARC as a new member for 
	{% elif member.membership_status == 'C' %}
	<p>Your current membership expires DATE. You can renew for the following year for 
	{% elif member.membership_status == 'LR' %}
	<p>Your membership expired DATE. You can renew for this year for 
	{% elif member.membership_status == 'LN' %}
	<p>Your membership expired DATE. You can rejoin the EARC for 
	{% endif %}
	${{ member.member_dues_amount|floatformat:2 }}.</p>
	
	<script src="https://www.paypalobjects.com/api/checkout.js"></script>

	<div id="paypal-button-container"></div>

	<div id="thanks" style="display:none;">
	    <p>Thanks for your dues payment! Your member status will be updated shortly.</p>
	    <p><a href="{% url 'member_profile' user.member.id %}">Return to member profile</a></p>
	</div>

	<script>
	    paypal.Button.render({

	        env: 'sandbox', // sandbox | production

	        client: {
	            sandbox:    'ARUURUAwV5Cgbzty9Y2giK_TgFOcmgFg9lelJsUSAh1r3s8pdacNTU54sW0WqxWLqqjW6eFgWeqW5zxw',
	            production: 'AdnbGQXaAlCAhpBvvkV4F9u8lylrTZFAXzwJrKTtSQqhSQiZRoDlbVIJ3JGEczdwz6FUuL31c9h1n1uJ'
	        },

	        payment: function(data, actions) {
	            return actions.payment.create({
	                payment: {
	                    transactions: [
	                        {
	                            amount: { total: '{{ member.member_dues_amount|floatformat:2 }}', currency: 'USD' },
	                            item_list: {
	                                items: [
	                                    {
	                                        sku: '{{ member.member_dues_type }}',
	                                        name: '{{ member.member_dues_description }}',
	                                        price: '{{ member.member_dues_amount|floatformat:2 }}',
	                                        currency: 'USD',
	                                        quantity: '1'
	                                    }
	                                ]
	                            }
	                        }
	                    ]
	                }
	            });
	        },

	        // Wait for the payment to be authorized by the customer

	        onAuthorize: function(data, actions) {

	            // Execute the payment

	                return actions.payment.execute().then(function() {

	                    // Show a thank-you note

	                    document.querySelector('#paypal-button-container').style.display = 'none';
	                    document.querySelector('#thanks').style.display = 'block';
	                });
	        }
	    }, '#paypal-button-container');

	</script>

{% endblock %}